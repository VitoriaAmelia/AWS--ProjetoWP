# ðŸš€ Criando Launch Template na EC2

## Passo a Passo

1. No menu lateral da **EC2**, procure por **Launch Template**  

2. Clique em **Create Launch Template**  

3. DÃª um **nome** e uma **descriÃ§Ã£o** ao template  

4. Selecione o campo do **Auto Scaling Guidance**  

5. Na prÃ³xima etapa, procure por **Quick Start** e escolha a **Amazon Linux** como imagem (AMI)  

    <img width="622" height="368" alt="Image" src="https://github.com/user-attachments/assets/60dba680-ea1c-450b-842f-e3a19a666f71" />

6. Selecione **t2.micro** como tipo de instÃ¢ncia  

7. Clique em **Create new key pair**  

8. DÃª um nome e crie a chave  

    <img width="635" height="388" alt="Image" src="https://github.com/user-attachments/assets/3f61e6fe-4ecd-48e6-9426-d9800e49bbee" />


9. Selecione o **Security Group** da EC2  

    <img width="617" height="226" alt="Image" src="https://github.com/user-attachments/assets/f4926e30-af0f-42df-bed2-1889a48be14a" />

10. Em Resource tags, se necessÃ¡rio, adicione **tags**

11. Role atÃ© **Advanced Details**  

12. Cole seu **User Data**

    <img width="625" height="400" alt="Image" src="https://github.com/user-attachments/assets/d3a137cb-10a1-44d6-8a39-a15544d066d8" />

13. Meu User Data:

        #!/bin/bash
        
        # ConfiguraÃ§Ãµes iniciais
        db_name=""
        db_user=""
        db_pass=""
        efs_id=""
        db_endpoint=""
        docker_compose_ver="v2.34.0"
        project_path="/home/ec2-user/projeto-docker"
        efs_path="/mnt/efs"
        
        # AtualizaÃ§Ãµes bÃ¡sicas
        yum update -y
        yum install -y aws-cli
        
        # InstalaÃ§Ã£o e configuraÃ§Ã£o do Docker
        yum install -y docker
        systemctl enable docker
        systemctl start docker
        usermod -a -G docker ec2-user
        
        # InstalaÃ§Ã£o do Docker Compose
        curl -SL https://github.com/docker/compose/releases/download/${docker_compose_ver}/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
        chmod +x /usr/local/bin/docker-compose
        
        # InstalaÃ§Ã£o do EFS utils
        yum install -y amazon-efs-utils
        mkdir -p ${efs_path}
        
        # Retry para montar o EFS
        retries=5
        until mount -t efs ${efs_id}:/ ${efs_path}; do
          ((retries--))
          if [ $retries -le 0 ]; then
            echo "Falha ao montar o EFS apÃ³s vÃ¡rias tentativas" >> /var/log/user-data.log
            exit 1
          fi
          echo "Tentando montar EFS novamente em 10s..." >> /var/log/user-data.log
          sleep 10
        done
        
        # EFS montado automaticamente toda vez que a instÃ¢ncia iniciar
        echo "${efs_id}:/ ${efs_path} efs defaults,_netdev 0 0" >> /etc/fstab
        
        # PermissÃµes
        chmod -R 777 ${efs_path}
        
        # CriaÃ§Ã£o e acesso ao diretÃ³rio do projeto
        mkdir -p ${project_path}
        cd ${project_path}
        
        # CriaÃ§Ã£o do docker-compose.yml
        cat > docker-compose.yml <<EOL
        version: '3.7'
        services:
          wordpress:
            image: wordpress:latest
            container_name: wordpress
            environment:
              WORDPRESS_DB_HOST: ${db_endpoint}
              WORDPRESS_DB_NAME: ${db_name}
              WORDPRESS_DB_USER: ${db_user}
              WORDPRESS_DB_PASSWORD: ${db_pass}
            ports:
              - 80:80
            volumes:
              - ${efs_path}:/var/www/html
        EOL
        
        # SÃ³ iniciar se o EFS estiver montado
        if mountpoint -q ${efs_path}; then
          docker-compose up -d
          echo "WordPress iniciado com sucesso" >> /var/log/user-data.log
        else
          echo "EFS nÃ£o montado, abortando docker-compose" >> /var/log/user-data.log
          exit 1
        fi

15. NÃ£o sabe como conseguir as informaÃ§Ãµes para a adicionar na User data? [Clique Aqui](https://github.com/VitoriaAmelia/AWS--ProjetoWP/blob/main/Dicas%3A%20Vari%C3%A1veis.md)

16. Clique em **Create Launch Template**  











